<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ふぁすもー | 日本人向け Phasmo 外部ツール</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #05070a;
      --bg-card: #11141b;
      --bg-chip: #1d222f;
      --accent: #5fd0ff;
      --accent-soft: #22455a;
      --text-main: #f5f7ff;
      --text-muted: #a3acc4;
      --danger: #ff6b81;
      --good: #7bffb3;
      --border-soft: #272b37;
      --radius-lg: 14px;
      --shadow-soft: 0 8px 20px rgba(0,0,0,0.5);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #10172a 0, #05070a 40%, #020308 100%);
      color: var(--text-main);
    }
    .app-shell {
      max-width: 1200px;
      margin: 0 auto;
      padding: 12px 10px 24px;
    }
    header {
      display: flex;
      flex-direction: column;
      gap: 4px;
      margin-bottom: 8px;
    }
    header h1 {
      font-size: 20px;
      margin: 0;
      letter-spacing: 0.04em;
    }
    header p {
      margin: 0;
      font-size: 12px;
      color: var(--text-muted);
    }
    .section-label {
      margin: 6px 2px 2px;
      font-size: 11px;
      color: var(--text-muted);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .section-label span.right {
      opacity: 0.7;
      font-size: 10px;
    }
    .pill-row {
      display: flex;
      flex-wrap: nowrap;
      gap: 8px;
      overflow-x: auto;
      padding: 6px 2px 4px;
      scrollbar-width: thin;
    }
    .pill {
      flex: 0 0 auto;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      padding: 4px 10px;
      font-size: 11px;
      color: var(--text-muted);
      background: rgba(10,12,18,0.8);
      display: inline-flex;
      align-items: center;
      gap: 4px;
      cursor: pointer;
      user-select: none;
      transition: background 0.15s, border-color 0.15s, color 0.15s, transform 0.05s;
    }
    .pill.active-include {
      border-color: var(--good);
      background: rgba(10,40,30,0.9);
      color: var(--good);
      transform: translateY(1px);
    }
    .pill.active-exclude {
      border-color: var(--danger);
      background: rgba(50,10,20,0.9);
      color: var(--danger);
      transform: translateY(1px);
    }
    .difficulty-toggle {
      display: inline-flex;
      border-radius: 999px;
      overflow: hidden;
      border: 1px solid var(--border-soft);
    }
    .difficulty-toggle button {
      border: none;
      padding: 3px 10px;
      font-size: 11px;
      background: transparent;
      color: var(--text-muted);
      cursor: pointer;
    }
    .difficulty-toggle button.active {
      background: rgba(40,70,110,0.9);
      color: var(--text-main);
    }

    .tool-card {
      margin-top: 8px;
      padding: 10px;
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-soft);
      background: radial-gradient(circle at top left, #1b2334 0, #070a12 55%, #05070a 100%);
      box-shadow: var(--shadow-soft);
      font-size: 11px;
      color: var(--text-muted);
    }
    .tool-title {
      font-size: 12px;
      font-weight: 600;
      color: var(--text-main);
      margin-bottom: 4px;
    }
    .tool-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      align-items: center;
      margin: 4px 0;
    }
    .tool-row label {
      font-size: 11px;
    }
    .tool-btn {
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      background: rgba(10,12,18,0.9);
      color: var(--text-main);
      padding: 4px 10px;
      font-size: 11px;
      cursor: pointer;
      user-select: none;
    }
    .tool-btn.active {
      border-color: var(--accent);
      background: rgba(40,70,110,0.95);
    }
    .tool-display {
      font-size: 11px;
      color: var(--text-main);
    }
    .tool-display span.small {
      font-size: 10px;
      color: var(--text-muted);
      margin-left: 4px;
    }

    .timer-row {
      display: flex;
      align-items: center;
      gap: 8px;
      margin: 4px 0;
      font-size: 11px;
    }
    .timer-label {
      min-width: 90px;
    }
    .timer-time {
      font-variant-numeric: tabular-nums;
      font-size: 13px;
      color: var(--text-main);
      min-width: 56px;
      text-align: right;
    }

    .ghost-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
      margin-top: 10px;
    }
    @media (min-width: 720px) {
      .ghost-grid { grid-template-columns: repeat(2, minmax(0, 1fr)); }
    }
    @media (min-width: 1024px) {
      .ghost-grid { grid-template-columns: repeat(3, minmax(0, 1fr)); }
    }
    .ghost-card {
      background: linear-gradient(145deg, rgba(18,23,35,0.96), rgba(7,10,18,0.97));
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-soft);
      box-shadow: var(--shadow-soft);
      padding: 10px 10px 8px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      position: relative;
      overflow: hidden;
    }
    .ghost-card.hidden {
      opacity: 0.18;
      filter: grayscale(0.8);
      pointer-events: none;
    }
    .ghost-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 4px;
    }
    .ghost-name {
      font-size: 15px;
      font-weight: 600;
      letter-spacing: 0.05em;
      text-transform: uppercase;
    }
    .ghost-meta {
      font-size: 11px;
      color: var(--text-muted);
      text-align: right;
    }
    .evidence-row {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin-top: 2px;
    }
    .evidence-chip {
      font-size: 10px;
      padding: 3px 6px;
      border-radius: 999px;
      background: var(--bg-chip);
      border: 1px solid var(--accent-soft);
      color: var(--text-main);
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }
    .evidence-chip.forced {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(95,208,255,0.3);
    }
    .badge {
      font-size: 9px;
      padding: 1px 5px;
      border-radius: 999px;
      border: 1px solid var(--accent-soft);
      color: var(--accent);
    }
    .row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 4px;
      font-size: 11px;
      color: var(--text-muted);
    }
    .row strong {
      font-size: 11px;
      color: var(--text-main);
    }
    .tags-row {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin-top: 2px;
    }
    .tag-chip {
      font-size: 9px;
      padding: 2px 6px;
      border-radius: 999px;
      background: rgba(18,24,38,0.9);
      border: 1px solid rgba(100,110,150,0.7);
      color: var(--text-muted);
    }
    .tests {
      font-size: 10px;
      color: var(--text-muted);
      margin-top: 4px;
      padding-top: 4px;
      border-top: 1px dashed rgba(70,76,100,0.7);
    }
    .tests ul {
      margin: 2px 0 0;
      padding-left: 15px;
    }
    .tests li {
      margin: 0;
      line-height: 1.3;
    }
    footer {
      margin-top: 14px;
      font-size: 10px;
      color: var(--text-muted);
      text-align: center;
      opacity: 0.7;
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <header>
      <h1>ふぁすもー <span style="opacity:.6;font-size:11px;">日本人向け Phasmo 外部ツール</span></h1>
      <p>証拠 / タグ / 速度感 / ハントSAN / 足音 / タイマー で一括管理。</p>
      <div class="section-label">
        <span>難易度（今は表示のみ）</span>
        <div class="difficulty-toggle" id="difficultyToggle">
          <button data-diff="standard" class="active">標準</button>
          <button data-diff="nightmare">Nightmare</button>
          <button data-diff="insanity">Insanity</button>
        </div>
      </div>
    </header>

    <!-- 足音・速度ツール -->
    <div class="section-label">
      <span>足音・速度ツール</span>
      <span class="right">速度感覚 / Rounded表記チェック</span>
    </div>
    <div class="tool-card">
      <div class="tool-title">ゴースト足音の速度イメージ</div>

      <div class="tool-row">
        <label>速度プリセット:</label>
        <button class="tool-btn" data-speed="50">50%</button>
        <button class="tool-btn" data-speed="75">75%</button>
        <button class="tool-btn" data-speed="100">100%</button>
        <button class="tool-btn" data-speed="125">125%</button>
        <button class="tool-btn" data-speed="150">150%</button>
      </div>

      <div class="tool-row">
        <label>カスタム速度 (%):</label>
        <input id="speedSlider" type="range" min="50" max="150" value="100" step="1" style="flex:1;" />
      </div>

      <div class="tool-row">
        <div class="tool-display" id="speedDisplay">
          実測: 100% <span class="small">(丸め: 100%)</span>
        </div>
      </div>

      <div class="tool-row">
        <button class="tool-btn" id="stepPlay">▶ 足音再生</button>
        <button class="tool-btn" id="stepStop">■ 停止</button>
        <span class="small" style="opacity:.8;">※足音風クリック音で間隔だけ確認する用</span>
      </div>
    </div>

    <!-- タイマー -->
    <div class="section-label">
      <span>タイマー</span>
      <span class="right">スマッジ / クールダウン / ハント</span>
    </div>
    <div class="tool-card">
      <div class="tool-title">簡易タイマー（秒）</div>

      <div class="timer-row" data-duration="90">
        <div class="timer-label">スマッジ 90s</div>
        <div class="timer-time" data-role="time">01:30</div>
        <button class="tool-btn" data-role="start">▶</button>
        <button class="tool-btn" data-role="stop">■</button>
        <button class="tool-btn" data-role="reset">↺</button>
      </div>

      <div class="timer-row" data-duration="180">
        <div class="timer-label">スマッジ 180s</div>
        <div class="timer-time" data-role="time">03:00</div>
        <button class="tool-btn" data-role="start">▶</button>
        <button class="tool-btn" data-role="stop">■</button>
        <button class="tool-btn" data-role="reset">↺</button>
      </div>

      <div class="timer-row" data-duration="20">
        <div class="timer-label">ハント目安 20s</div>
        <div class="timer-time" data-role="time">00:20</div>
        <button class="tool-btn" data-role="start">▶</button>
        <button class="tool-btn" data-role="stop">■</button>
        <button class="tool-btn" data-role="reset">↺</button>
      </div>
    </div>

    <!-- 証拠・タグフィルタ -->
    <div class="section-label">
      <span>証拠フィルタ</span>
      <span class="right">タップで「必要 → 排除 → 解除」</span>
    </div>
    <div class="pill-row" id="evidenceRow"></div>

    <div class="section-label">
      <span>タグフィルタ</span>
      <span class="right">重ねがけで候補絞り込み</span>
    </div>
    <div class="pill-row" id="tagRow"></div>

    <!-- ゴースト一覧 -->
    <div class="ghost-grid" id="ghostGrid"></div>

    <footer>
      ふぁすもー / 主専用ビルド。ブラウザだけで動作（オフライン可）。<br/>
      情報は自己検証用メモとして利用してください。
    </footer>
  </div>

  <script>
    // ===== ゴーストデータ =====
    const GHOSTS = [
      {
        id: "spirit",
        name: "Spirit",
        evidences: ["EMF Lv5", "スピボ", "ゴーストライティング"],
        forcedEvidences: [],
        huntSanity: { base: 50, note: "標準。スマッジ後180秒はハント不可。" },
        speeds: { base: "~1.7 m/s", detail: "速度・挙動ともに基準ゴースト。" },
        abilities: [
          "固有能力ほぼなし。挙動は“基準”として比較に使う。"
        ],
        tests: [
          "スマッジ後に180秒以上ハントが来ない → Spirit濃厚（他は90秒前後）。"
        ],
        tags: ["標準", "スマッジ延長"]
      },
      {
        id: "wraith",
        name: "Wraith",
        evidences: ["EMF Lv5", "スピボ", "DOTS"],
        forcedEvidences: [],
        huntSanity: { base: 50, note: "標準。" },
        speeds: { base: "~1.7 m/s", detail: "速度は標準。テレポート挙動あり。" },
        abilities: [
          "ランダムにプレイヤーへテレポートして干渉。",
          "塩を踏んでも足跡（UV）が出ない。"
        ],
        tests: [
          "塩を踏んだのにUVで足跡が出ない → Wraith確定。",
          "不自然に離れた場所でEMFや足音が出る → テレポート挙動を疑う。"
        ],
        tags: ["テレポート", "塩NG", "標準"]
      },
      {
        id: "phantom",
        name: "Phantom",
        evidences: ["スピボ", "DOTS", "指紋"],
        forcedEvidences: [],
        huntSanity: { base: 50, note: "イベントでSAN大きめに削る。" },
        speeds: { base: "~1.7 m/s", detail: "ハント中の点滅が遅く、姿が見えにくい。" },
        abilities: [
          "写真を撮るとモデルが一時的に消える。",
          "ゴーストイベント1回でSAN -10%。"
        ],
        tests: [
          "イベント中に写真を撮って姿だけ消える（干渉は残る）→ Phantom候補。",
          "ハント中の点滅間隔が長く、姿がほぼ見えない。"
        ],
        tags: ["写真消失", "SAN大ダメ", "視認性低"]
      },
      {
        id: "poltergeist",
        name: "Poltergeist",
        evidences: ["スピボ", "ゴーストライティング", "指紋"],
        forcedEvidences: [],
        huntSanity: { base: 50, note: "標準。" },
        speeds: { base: "~1.7 m/s", detail: "速度標準。投擲特化。" },
        abilities: [
          "一度に複数の物を投げる“マルチスロー”。",
          "物投げ時にSANを比較的大きく削る。"
        ],
        tests: [
          "物が一気に複数飛ぶ → Polter本命。",
          "アイテム部屋を作って投げ方を観察する。"
        ],
        tags: ["投擲多い", "SANダメ", "標準"]
      },
      {
        id: "banshee",
        name: "Banshee",
        evidences: ["DOTS", "指紋", "ゴーストオーブ"],
        forcedEvidences: [],
        huntSanity: { base: 50, note: "ターゲット1人基準で判定。" },
        speeds: { base: "~1.7 m/s", detail: "速度標準。ターゲット追尾型。" },
        abilities: [
          "ターゲットを1人決めて、そのプレイヤーを優先して狙う。",
          "パラボラで“悲鳴”の特殊音を出す。"
        ],
        tests: [
          "ターゲット以外の近くを素通りするハント → Banshee候補。",
          "パラボラで悲鳴SEが出たらBansheeほぼ確。"
        ],
        tags: ["単体ターゲット", "パラボラ悲鳴"]
      },
      {
        id: "jinn",
        name: "Jinn",
        evidences: ["EMF Lv5", "氷点下温度", "指紋"],
        forcedEvidences: [],
        huntSanity: { base: 50, note: "標準。ブレーカーON時のみ加速。" },
        speeds: { base: "2.5 m/s(遠距離)", detail: "ブレーカーONかつ遠距離で加速。接近すると減速。" },
        abilities: [
          "ブレーカーONで、遠距離かつ視認しているときに加速。",
          "基本的にブレーカーを落としにくい傾向。"
        ],
        tests: [
          "ブレーカーONで距離を取ると明らかに速い → Jinn候補。",
          "ブレーカーを落とすと速度が普通になるか確認。"
        ],
        tags: ["遠距離加速", "ブレーカー依存"]
      },
      {
        id: "mare",
        name: "Mare",
        evidences: ["スピボ", "ゴーストライティング", "ゴーストオーブ"],
        forcedEvidences: [],
        huntSanity: { base: 60, note: "暗所60% / 明所40%でハント開始。" },
        speeds: { base: "~1.7 m/s", detail: "速度標準。暗闇で凶暴。" },
        abilities: [
          "暗所で早ハント（平均SAN60%）。",
          "電気を消しがち。明るい部屋では活動控えめ。"
        ],
        tests: [
          "ライトONでローム・干渉が減る＆ハントが遅くなる → Mare寄り。",
          "わざと明かりを増やして様子を見る。"
        ],
        tags: ["暗闇強化", "早ハント", "ライト嫌い"]
      },
      {
        id: "revenant",
        name: "Revenant",
        evidences: ["ゴーストライティング", "氷点下温度", "ゴーストオーブ"],
        forcedEvidences: [],
        huntSanity: { base: 50, note: "標準。" },
        speeds: { base: "3.0 / 1.0 m/s", detail: "視認中は爆速、見失うと超鈍足。" },
        abilities: [
          "ターゲットを視認している間は非常に速い。",
          "視認していないときは極端に遅くなる。"
        ],
        tests: [
          "ハント中、直線で追われると異常に速いが、隠れると足音が極端に遅くなる → Rev濃厚。"
        ],
        tags: ["LOS爆速", "非LOS激遅"]
      },
      {
        id: "demon",
        name: "Demon",
        evidences: ["ゴーストライティング", "氷点下温度", "指紋"],
        forcedEvidences: [],
        huntSanity: { base: 70, note: "最速クラスの早ハント。" },
        speeds: { base: "~1.7 m/s", detail: "速度標準。頻繁にハントを仕掛ける。" },
        abilities: [
          "平均SAN70%付近からハント可能。",
          "スマッジから再ハントまでの待機が短い。クルシフィックスも燃えやすい。"
        ],
        tests: [
          "高SAN帯で何度もハント → Demon本命。",
          "クルシフィックスが広範囲で早く消費されるかを見る。"
        ],
        tags: ["超早ハント", "クルシ消費増"]
      },
      {
        id: "yurei",
        name: "Yurei",
        evidences: ["氷点下温度", "ゴーストオーブ", "DOTS"],
        forcedEvidences: [],
        huntSanity: { base: 50, note: "標準。ドア叩きでSANを多めに削る。" },
        speeds: { base: "~1.7 m/s", detail: "速度標準。ドアslamイベント特化。" },
        abilities: [
          "ドアを強く閉めるイベント時にSANを多く削る。",
          "スマッジで一時的に部屋に“閉じ込め”できる。"
        ],
        tests: [
          "ドアバンでSANが大きく落ちるならYurei候補。",
          "スマッジ後しばらくロームが減るか確認。"
        ],
        tags: ["ドアSAN削り", "ローム制限"]
      },
      {
        id: "oni",
        name: "Oni",
        evidences: ["EMF Lv5", "氷点下温度", "DOTS"],
        forcedEvidences: [],
        huntSanity: { base: 50, note: "標準。活動量が多いゴリラ枠。" },
        speeds: { base: "~1.8 m/s", detail: "やや速め。イベント頻度が高い。" },
        abilities: [
          "イベント頻度が高く、姿を見せることが多い。",
          "エアボール（白玉）ゴーストイベントをしない。"
        ],
        tests: [
          "やたら出てくる・物もよく動く・エアボールが一切ない → Oni濃厚。"
        ],
        tags: ["高活動", "エアボール無し"]
      },
      {
        id: "yokai",
        name: "Yokai",
        evidences: ["スピボ", "DOTS", "ゴーストオーブ"],
        forcedEvidences: [],
        huntSanity: { base: 80, note: "ボイチャに反応して早ハントしやすい。" },
        speeds: { base: "1.5〜1.7 m/s", detail: "速度標準。声に反応しやすい。" },
        abilities: [
          "近距離での会話・騒音で早めにハントを起こす。",
          "ハント中、遠くの声はほぼ聞こえない。"
        ],
        tests: [
          "高SAN帯でしゃべっている最中にだけハントが来る → Yokai候補。",
          "ハント中に遠距離ボイチャで釣れないか試す。"
        ],
        tags: ["声トリガー", "高SANハント"]
      },
      {
        id: "hantu",
        name: "Hantu",
        evidences: ["氷点下温度", "ゴーストオーブ", "指紋"],
        forcedEvidences: ["氷点下温度"],
        huntSanity: { base: 50, note: "標準。温度依存で速度変化。" },
        speeds: { base: "1.4〜2.7 m/s", detail: "寒いほど速い。ブレーカーOFFで強い。" },
        abilities: [
          "室温が低いエリアで大きく加速する。",
          "ブレーカーOFF時、ハント中に吐息が見えやすい。"
        ],
        tests: [
          "ブレーカーOFFでハントさせ、冷えた廊下などで露骨に加速 → Hantu濃厚。",
          "温度計で温度差を確認。"
        ],
        tags: ["温度依存速度", "強制証拠"]
      },
      {
        id: "goryo",
        name: "Goryo",
        evidences: ["EMF Lv5", "DOTS", "指紋"],
        forcedEvidences: ["DOTS"],
        huntSanity: { base: 50, note: "標準。" },
        speeds: { base: "~1.7 m/s", detail: "DOTS専用挙動あり。" },
        abilities: [
          "DOTSは基本的に“カメラ越し＋同室に人がいない”時のみ見える。",
          "ローム範囲が狭め。あまり部屋を変えない。"
        ],
        tests: [
          "同室だとDOTSが見えず、三脚カメラ越しだと安定して映る → Goryo本命。",
          "ゴーストルームからあまり動かないかを見る。"
        ],
        tags: ["DOTS専用挙動", "強制証拠", "ローム少ない"]
      },
      {
        id: "myling",
        name: "Myling",
        evidences: ["EMF Lv5", "ゴーストライティング", "指紋"],
        forcedEvidences: [],
        huntSanity: { base: 50, note: "標準。" },
        speeds: { base: "~1.7 m/s", detail: "ハント中の足音が小さい。" },
        abilities: [
          "パラボラマイクでの声・音が出やすい。",
          "ハント中の足音が他ゴーストより静か。"
        ],
        tests: [
          "パラボラで頻繁にノイズ／声を拾う。",
          "ハント中、かなり近づかないと足音が聞こえにくい → Myling候補。"
        ],
        tags: ["静音足音", "パラボラ頻度"]
      },
      {
        id: "onryo",
        name: "Onryo",
        evidences: ["スピボ", "ゴーストオーブ", "氷点下温度"],
        forcedEvidences: [],
        huntSanity: { base: 60, note: "火（ロウソク）が絡むと挙動変化。" },
        speeds: { base: "~1.7 m/s", detail: "速度標準。炎を嫌う。" },
        abilities: [
          "ロウソク / 焚き火などの“炎”でハントを抑制。",
          "炎が3回消えると、それをトリガーにハントを起こしやすい。"
        ],
        tests: [
          "ロウソクを部屋に多く置いた状態だとハントが極端に減る → Onryo疑い。",
          "炎が消えた直後にだけハントが来るかを見る。"
        ],
        tags: ["炎トリガー", "早ハント"]
      },
      {
        id: "the_twins",
        name: "The Twins",
        evidences: ["EMF Lv5", "スピボ", "氷点下温度"],
        forcedEvidences: [],
        huntSanity: { base: 50, note: "標準。2体分の干渉。" },
        speeds: { base: "1.5 / 1.9 m/s", detail: "本体と分身で速度が違う。" },
        abilities: [
          "“本体”と“もう1体”が別々に干渉。離れた場所で同時に干渉が起こりやすい。",
          "ハント時の移動速度が2パターンある。"
        ],
        tests: [
          "全く違う場所でほぼ同時に干渉が起こる → Twins候補。",
          "複数回ハントの足音速度を比べて、速い／遅いが混ざっていないか確認。"
        ],
        tags: ["二箇所干渉", "速度2パターン"]
      },
      {
        id: "raiju",
        name: "Raiju",
        evidences: ["EMF Lv5", "DOTS", "ゴーストオーブ"],
        forcedEvidences: [],
        huntSanity: { base: 65, note: "電子機器周りで早ハント＆高速。" },
        speeds: { base: "〜2.8 m/s", detail: "近くに電子機器が多いと大幅加速。" },
        abilities: [
          "近くに点いている電子機器が多いほど速度アップ。",
          "機器を遠距離からでも妨害（EMPっぽい挙動）しやすい。"
        ],
        tests: [
          "電子機器を周囲に置いた状態でハントさせると露骨に速い → Raiju濃厚。",
          "機器を全部OFFにして速度が普通に戻るか確認。"
        ],
        tags: ["電子機器加速", "高SANハント"]
      },
      {
        id: "obake",
        name: "Obake",
        evidences: ["EMF Lv5", "ゴーストオーブ", "指紋"],
        forcedEvidences: ["指紋"],
        huntSanity: { base: 50, note: "標準。指紋が特殊＆消えやすい。" },
        speeds: { base: "~1.7 m/s", detail: "速度標準。指紋・モデル変化が特徴。" },
        abilities: [
          "指紋が出ない判定が25%あり、そもそも付かないことが多い。",
          "6本指・二重ライトスイッチなど、レア指紋パターンが存在。",
          "ハント中の点滅でゴーストモデルが別の姿に変わることがある。"
        ],
        tests: [
          "指紋が付いた場所で明らかに変な形（6本指／二重スイッチ）ならObakeほぼ確。",
          "指紋の消えるタイミングが他より早いことがある。",
          "長めのハントで点滅ごとにモデルがコロコロ変わるか観察。"
        ],
        tags: ["レア指紋", "指紋消失", "モデル変化", "強制証拠"]
      },
      {
        id: "mimic",
        name: "The Mimic",
        evidences: ["スピボ", "氷点下温度", "指紋＋ゴーストオーブ"],
        forcedEvidences: ["ゴーストオーブ"],
        huntSanity: { base: 50, note: "模倣先ゴーストに依存。" },
        speeds: { base: "可変", detail: "模倣しているゴーストの挙動に依存。" },
        abilities: [
          "他の任意のゴーストの挙動・能力を模倣する。",
          "常に“偽オーブ”を伴う（4証拠持ち）。"
        ],
        tests: [
          "証拠3つ出ているのにオーブがセットと噛み合わない → Mimic疑い。",
          "挙動・速度・ハント閾値がコロコロ変わるように感じる場合も要注意。"
        ],
        tags: ["オーブ確定", "挙動ランダム", "4証拠"]
      },
      {
        id: "moroi",
        name: "Moroi",
        evidences: ["スピボ", "ゴーストライティング", "氷点下温度"],
        forcedEvidences: ["スピボ"],
        huntSanity: { base: 50, note: "呪いでSAN減少を加速。" },
        speeds: { base: "〜2.5 m/s", detail: "呪われたプレイヤーのSANが低いほど高速化。" },
        abilities: [
          "スピボ応答 or パラボラ囁きで対象プレイヤーを“呪い”、SAN減少を加速させる。",
          "呪われたプレイヤーがいると、低SAN時にゲーム最速クラスの速度になる。"
        ],
        tests: [
          "スピボ応答後、明らかにSANの減りが早い → Moroi候補。",
          "終盤ハントが異常に速くなり、しかもスマッジの足止め時間が長い。"
        ],
        tags: ["SAN呪い", "高速化", "強制証拠"]
      },
      {
        id: "deogen",
        name: "Deogen",
        evidences: ["スピボ", "ゴーストライティング", "DOTS"],
        forcedEvidences: ["スピボ"],
        huntSanity: { base: 40, note: "やや遅めハント開始。" },
        speeds: { base: "3.0 / 0.4 m/s", detail: "遠距離で爆速、近づくと超鈍足。" },
        abilities: [
          "常にプレイヤー位置を正確に把握し、隠れても見つかる。",
          "距離依存速度：離れていると速く、至近距離だと歩いて追いつかないほど遅い。",
          "スピボで独特の荒い息・いびきのような応答が出る。"
        ],
        tests: [
          "ハント中にあえて足元をぐるぐる回っても絶対に追いつかれない → Deogenほぼ確。",
          "スピボで“息荒い”専用ボイスが出たらDeogen濃厚。"
        ],
        tags: ["距離依存速度", "位置把握", "強制証拠"]
      },
      {
        id: "thaye",
        name: "Thaye",
        evidences: ["ゴーストライティング", "ゴーストオーブ", "DOTS"],
        forcedEvidences: [],
        huntSanity: { base: 75, note: "序盤75%からハント。時間経過で弱体化。" },
        speeds: { base: "2.75→1.0 m/s", detail: "近くにいる時間が長いほど速度・ハント閾値が下がる。" },
        abilities: [
          "プレイヤーが近くにいる時間に応じて“老化”し、活動・速度・ハントSANが段階的に低下。",
          "序盤は最凶クラス、終盤は雑魚化する。"
        ],
        tests: [
          "開幕すぐ高SANでハント→ その後どんどん大人しく遅くなる → Thaye本命。",
          "同じ部屋に長時間居座って、ハント間隔・速度の変化を見る。"
        ],
        tags: ["早ハント", "時間で弱体化"]
      },
      {
        id: "shade",
        name: "Shade",
        evidences: ["EMF Lv5", "ゴーストライティング", "氷点下温度"],
        forcedEvidences: [],
        huntSanity: { base: 35, note: "プレイヤー近くではほぼハントしない。" },
        speeds: { base: "~1.7 m/s", detail: "速度標準。極端に消極的。" },
        abilities: [
          "プレイヤーが近くにいるとイベント・ハントをほぼ起こさない。",
          "活動量が全体的に低く、“つまらないゴースト”になりがち。"
        ],
        tests: [
          "ずっと同室に居てもイベントほぼ無し＆ハントも来ない → Shade濃厚。",
          "部屋から離れたタイミングでだけハント・イベントが増えるか確認。"
        ],
        tags: ["超受け身", "低SANハント"]
      }
    ];

    const ALL_EVIDENCES = [
      "EMF Lv5",
      "スピボ",
      "ゴーストライティング",
      "DOTS",
      "ゴーストオーブ",
      "氷点下温度",
      "指紋"
    ];

    const ALL_TAGS = [
      "標準","スマッジ延長","テレポート","塩NG","写真消失","SAN大ダメ","視認性低",
      "投擲多い","SANダメ","単体ターゲット","パラボラ悲鳴","遠距離加速","ブレーカー依存",
      "暗闇強化","早ハント","ライト嫌い","LOS爆速","非LOS激遅","高活動","エアボール無し",
      "声トリガー","高SANハント","温度依存速度","強制証拠","DOTS専用挙動","ローム少ない",
      "静音足音","パラボラ頻度","炎トリガー","二箇所干渉","速度2パターン",
      "電子機器加速","レア指紋","指紋消失","モデル変化","オーブ確定","挙動ランダム","4証拠",
      "SAN呪い","高速化","位置把握","時間で弱体化","超受け身","低SANハント"
    ];

    // ===== 証拠・タグフィルタ =====
    const evidenceFilter = {};
    const activeTags = new Set();
    let currentDifficulty = "standard";

    ALL_EVIDENCES.forEach(ev => evidenceFilter[ev] = null);

    const evidenceRow = document.getElementById("evidenceRow");
    const tagRow = document.getElementById("tagRow");
    const ghostGrid = document.getElementById("ghostGrid");

    function applyEvidencePillStyle(el, state) {
      el.classList.remove("active-include", "active-exclude");
      if (state === "include") el.classList.add("active-include");
      else if (state === "exclude") el.classList.add("active-exclude");
    }

    function renderFilters() {
      evidenceRow.innerHTML = "";
      ALL_EVIDENCES.forEach(ev => {
        const pill = document.createElement("button");
        pill.className = "pill";
        pill.textContent = ev;
        pill.dataset.ev = ev;
        applyEvidencePillStyle(pill, evidenceFilter[ev]);
        pill.addEventListener("click", () => {
          const cur = evidenceFilter[ev];
          let next = null;
          if (cur === null) next = "include";
          else if (cur === "include") next = "exclude";
          else next = null;
          evidenceFilter[ev] = next;
          applyEvidencePillStyle(pill, next);
          renderGhosts();
        });
        evidenceRow.appendChild(pill);
      });

      tagRow.innerHTML = "";
      ALL_TAGS.forEach(tag => {
        const pill = document.createElement("button");
        pill.className = "pill";
        pill.textContent = tag;
        pill.dataset.tag = tag;
        if (activeTags.has(tag)) pill.classList.add("active-include");
        pill.addEventListener("click", () => {
          if (activeTags.has(tag)) activeTags.delete(tag);
          else activeTags.add(tag);
          pill.classList.toggle("active-include");
          renderGhosts();
        });
        tagRow.appendChild(pill);
      });
    }

    function ghostMatchesFilters(ghost) {
      const includeList = [];
      const excludeList = [];
      for (const ev of ALL_EVIDENCES) {
        if (evidenceFilter[ev] === "include") includeList.push(ev);
        if (evidenceFilter[ev] === "exclude") excludeList.push(ev);
      }
      for (const ev of includeList) {
        if (!ghost.evidences.includes(ev)) return false;
      }
      for (const ev of excludeList) {
        if (ghost.evidences.includes(ev)) return false;
      }
      if (activeTags.size > 0) {
        const hasAny = ghost.tags.some(t => activeTags.has(t));
        if (!hasAny) return false;
      }
      // 難易度フィルタは今は未実装（後から追加も可）
      return true;
    }

    function renderGhosts() {
      ghostGrid.innerHTML = "";
      GHOSTS.forEach(g => {
        const visible = ghostMatchesFilters(g);
        const card = document.createElement("article");
        card.className = "ghost-card";
        if (!visible) card.classList.add("hidden");

        const header = document.createElement("div");
        header.className = "ghost-header";
        const nameEl = document.createElement("div");
        nameEl.className = "ghost-name";
        nameEl.textContent = g.name;
        const meta = document.createElement("div");
        meta.className = "ghost-meta";
        meta.innerHTML = `
          <div>ハントSAN: <strong>${g.huntSanity.base}%</strong></div>
          <div style="font-size:10px;">${g.huntSanity.note || ""}</div>
        `;
        header.appendChild(nameEl);
        header.appendChild(meta);

        const evRow = document.createElement("div");
        evRow.className = "evidence-row";
        g.evidences.forEach(ev => {
          const chip = document.createElement("div");
          chip.className = "evidence-chip";
          chip.textContent = ev;
          if (g.forcedEvidences.includes(ev)) {
            chip.classList.add("forced");
            const b = document.createElement("span");
            b.className = "badge";
            b.textContent = "Forced";
            chip.appendChild(b);
          }
          evRow.appendChild(chip);
        });

        const speedRow = document.createElement("div");
        speedRow.className = "row";
        const left = document.createElement("div");
        left.innerHTML = `<strong>速度</strong> ${g.speeds.base}`;
        const right = document.createElement("div");
        right.textContent = g.speeds.detail;
        right.style.textAlign = "right";
        speedRow.appendChild(left);
        speedRow.appendChild(right);

        const tagRowDiv = document.createElement("div");
        tagRowDiv.className = "tags-row";
        g.tags.forEach(tag => {
          const chip = document.createElement("span");
          chip.className = "tag-chip";
          chip.textContent = tag;
          tagRowDiv.appendChild(chip);
        });

        const tests = document.createElement("div");
        tests.className = "tests";
        const abilTitle = document.createElement("div");
        abilTitle.textContent = "固有能力・0証拠テスト";
        const ul = document.createElement("ul");
        [...g.abilities, ...g.tests].forEach(t => {
          const li = document.createElement("li");
          li.textContent = t;
          ul.appendChild(li);
        });
        tests.appendChild(abilTitle);
        tests.appendChild(ul);

        card.appendChild(header);
        card.appendChild(evRow);
        card.appendChild(speedRow);
        card.appendChild(tagRowDiv);
        card.appendChild(tests);

        ghostGrid.appendChild(card);
      });
    }

    function initDifficultyToggle() {
      const wrap = document.getElementById("difficultyToggle");
      wrap.querySelectorAll("button").forEach(btn => {
        btn.addEventListener("click", () => {
          wrap.querySelectorAll("button").forEach(b => b.classList.remove("active"));
          btn.classList.add("active");
          currentDifficulty = btn.dataset.diff;
          // 難易度別ロジック入れるならここで
          renderGhosts();
        });
      });
    }

    // ===== 足音・速度ツール =====
    const speedSlider = document.getElementById("speedSlider");
    const speedDisplay = document.getElementById("speedDisplay");
    const stepPlayBtn = document.getElementById("stepPlay");
    const stepStopBtn = document.getElementById("stepStop");
    const presetBtns = document.querySelectorAll(".tool-btn[data-speed]");

    const BASE_INTERVAL_MS = 500; // 100% = 0.5秒間隔くらい（基準）

    let audioCtx = null;
    let stepTimerId = null;
    let currentPercent = 100;

    function roundedPercent(p) {
      const buckets = [50, 75, 100, 125, 150];
      let best = buckets[0];
      let diff = Math.abs(p - best);
      for (const b of buckets) {
        const d = Math.abs(p - b);
        if (d < diff) {
          diff = d;
          best = b;
        }
      }
      return best;
    }

    function updateSpeedDisplay() {
      const p = currentPercent;
      const r = roundedPercent(p);
      speedDisplay.innerHTML =
        `実測: ${p.toFixed(0)}% <span class="small">(丸め: ${r}%)</span>`;
    }

    function playClick() {
      if (!audioCtx) return;
      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      osc.frequency.value = 800;
      gain.gain.value = 0.2;
      osc.connect(gain);
      gain.connect(audioCtx.destination);
      const now = audioCtx.currentTime;
      osc.start(now);
      osc.stop(now + 0.04);
    }

    function startSteps() {
      stopSteps();
      if (!audioCtx) {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      }
      const interval = BASE_INTERVAL_MS * (100 / currentPercent);
      playClick();
      stepTimerId = setInterval(playClick, interval);
    }

    function stopSteps() {
      if (stepTimerId) {
        clearInterval(stepTimerId);
        stepTimerId = null;
      }
    }

    speedSlider.addEventListener("input", () => {
      currentPercent = parseFloat(speedSlider.value);
      updateSpeedDisplay();
      if (stepTimerId) startSteps();
    });

    presetBtns.forEach(btn => {
      btn.addEventListener("click", () => {
        const p = parseFloat(btn.dataset.speed);
        currentPercent = p;
        speedSlider.value = p;
        presetBtns.forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        updateSpeedDisplay();
        if (stepTimerId) startSteps();
      });
    });

    stepPlayBtn.addEventListener("click", () => {
      presetBtns.forEach(b => {
        if (parseFloat(b.dataset.speed) === currentPercent) {
          b.classList.add("active");
        }
      });
      startSteps();
    });

    stepStopBtn.addEventListener("click", () => {
      stopSteps();
      presetBtns.forEach(b => b.classList.remove("active"));
    });

    // ===== タイマー =====
    const timerRows = document.querySelectorAll(".timer-row");
    const timerState = new Map(); // row -> {remaining, original, id}

    function formatTime(sec) {
      const m = Math.floor(sec / 60);
      const s = sec % 60;
      return `${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}`;
    }

    timerRows.forEach(row => {
      const dur = parseInt(row.dataset.duration, 10);
      const timeEl = row.querySelector('[data-role="time"]');
      const startBtn = row.querySelector('[data-role="start"]');
      const stopBtn = row.querySelector('[data-role="stop"]');
      const resetBtn = row.querySelector('[data-role="reset"]');

      timerState.set(row, { remaining: dur, original: dur, id: null });
      timeEl.textContent = formatTime(dur);

      startBtn.addEventListener("click", () => {
        const st = timerState.get(row);
        if (st.id) return;
        if (!audioCtx) {
          // ここで初期化すると、初回再生で音許可も兼ねる
          audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        }
        st.id = setInterval(() => {
          st.remaining -= 1;
          if (st.remaining <= 0) {
            st.remaining = 0;
            clearInterval(st.id);
            st.id = null;
            // 終了時に軽くクリック音
            playClick();
          }
          timeEl.textContent = formatTime(st.remaining);
        }, 1000);
      });

      stopBtn.addEventListener("click", () => {
        const st = timerState.get(row);
        if (st.id) {
          clearInterval(st.id);
          st.id = null;
        }
      });

      resetBtn.addEventListener("click", () => {
        const st = timerState.get(row);
        if (st.id) {
          clearInterval(st.id);
          st.id = null;
        }
        st.remaining = st.original;
        timeEl.textContent = formatTime(st.remaining);
      });
    });

    // ===== 初期化 =====
    renderFilters();
    initDifficultyToggle();
    renderGhosts();
    updateSpeedDisplay();
  </script>
</body>
</html>
